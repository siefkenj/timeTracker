// Generated by CoffeeScript 1.9.2

/*
 * START OF THE APP
 */
var app, fileread, statsController;

app = angular.module('statsControllers', []);


/*
 * StatsController
 */

statsController = function($scope, $routeParams, dataService) {
  $scope.downloadData = function() {
    var blob, data, dataStr, fileName;
    console.log('hi');
    data = dataService.collection.find();
    fileName = "timeTrackerData.json";
    dataStr = JSON.stringify(data, null, 4);
    blob = new Blob([dataStr], {
      type: 'application/json'
    });
    return window.saveAs(blob, fileName);
  };
  $scope.$watch('loadedData', function() {
    var data, e;
    try {
      data = JSON.parse($scope.loadedData);
    } catch (_error) {
      e = _error;
      return;
    }
    console.log('overridding saved data');
    dataService.collection.setData(data);
    return dataService.collection.save();
  });
};

app.controller('StatsController', ['$scope', '$routeParams', 'dataService', statsController]);

fileread = function() {
  return {
    scope: {
      fileread: '='
    },
    link: function(scope, elm, attrs) {
      return elm.bind('change', function(evt) {
        var reader;
        reader = new FileReader;
        reader.onload = function(loadEvt) {
          return scope.$apply(function() {
            return scope.fileread = loadEvt.target.result;
          });
        };
        return reader.readAsText(evt.target.files[0]);
      });
    }
  };
};

app.directive('fileread', fileread);
